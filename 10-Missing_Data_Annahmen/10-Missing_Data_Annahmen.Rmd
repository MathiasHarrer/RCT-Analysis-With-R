---
title: Evaluation Randomisiert-Kontrollierter Studien und Experimente mit \textsf{R}
subtitle: Missing Data
author: Prof. Dr. David Ebert & Mathias Harrer
date: Graduiertenseminar TUM-FGZ
institute: Psychology & Digital Mental Health Care, Technische Universität München
output: binb::metropolis
fontsize: 11pt
bibliography: bib.bib
csl: apa.csl
monofont: "Fira Code"
mainfont: "Fira Sans"
header-includes: |
  ```{=latex}
  \makeatletter
  \let\@@magyar@captionfix\relax
  \makeatother
  \usepackage{xcolor}
  \usepackage{tikz}
  \definecolor{protectBlue}{RGB}{48,124,148}
  \definecolor{protectGreen}{RGB}{161, 198, 66}
  \definecolor{verywhite}{rgb}{1, 1, 1}
  \usepackage{multicol}
  \hypersetup{colorlinks,citecolor=protectGreen,
    filecolor=red,linkcolor=protectGreen,urlcolor=blue}
  \setbeamercolor{progress bar}{fg=protectGreen}
  \setbeamercolor{alerted text}{fg=protectGreen}
  \setbeamercolor{frametitle}{bg=protectBlue}
  \setbeamercolor{normal text}{fg=protectBlue}
  \titlegraphic{%
  \hspace*{6cm}~%
  \includegraphics[width=2cm]{logo/tum-lightblue}
  \hspace*{0.3cm}~%
  \includegraphics[width=2cm]{logo/protect}}
  \setbeamertemplate{frame footer}{Evaluation Randomisiert-Kontrollierter Studien und Experimente mit \textsf{R}}%         <- !!SET FOOTER TITLE!!
  \makeatletter
  \setlength{\metropolis@frametitle@padding}{2.2ex}
  \setbeamertemplate{footline}{%
      \begin{beamercolorbox}[wd=\textwidth, sep=0.7ex]{footline}
          \usebeamerfont{page number in head/foot}%
          \usebeamertemplate*{frame footer}
          \hfill%
          \usebeamertemplate*{frame numbering}
      \end{beamercolorbox}%
  }
  \setbeamertemplate{frametitle}{%
    \nointerlineskip%
    \begin{beamercolorbox}[%
        wd=\paperwidth,%
        sep=0pt,%
        leftskip=\metropolis@frametitle@padding,%
        rightskip=\metropolis@frametitle@padding,%
      ]{frametitle}%
    \metropolis@frametitlestrut@start%
    \insertframetitle%
    \nolinebreak%
    \metropolis@frametitlestrut@end%
    \hfill
    \includegraphics[height=2ex,keepaspectratio]{logo/tum_white}
    \end{beamercolorbox}%
  }
  \newlength{\cslhangindent}
  \setlength{\cslhangindent}{1.5em}
  \newenvironment{CSLReferences}[3]%
  {\setlength{\parindent}{0pt}%
  \everypar{\setlength{\hangindent}{\cslhangindent}}\ignorespaces}%
  ```
---

```{r,setup, include=FALSE}
knitr::opts_chunk$set(cache=TRUE, comment = "#>", background = '#F7F7F7')
```


# Missing Data-Mechanismen

## Unbequeme Wahrheiten ... (I)

_"Obviously the best way to treat missing data is not to have them."_
\newline \scriptsize @orchard1972missing \par \normalsize

$$~$$

Fehlende Werte sind aber, insbesondere in der medizinischen und psychologischen Forschung, 
häufig **\alert{unvermeidbar}**!

## Unbequeme Wahrheiten ... (II)

\metroset{block=fill} 
\begin{exampleblock}{Taxonomie: Gründe für fehlende Werte in klinischen Studien}
\begin{itemize}
  \item \textbf{Instrumente}: Response Burden, zu langes Assessment, ... 
  \item \textbf{Teilnehmende}: Überforderung, Privatsphäre-Bedenken, Movationsprobleme, ...
  \item \textbf{Center}: Inadäquate Umsetzung des Studienmethodik, Personalmangel, ...
  \item \textbf{Personal}: Falsche Datenerfassung, Datenverlust, falsche Dateneingabe, ...
  \item \textbf{Studie}: Technische Fehler, Zeitverzögerungen bei Follow-Ups, ...
\end{itemize}
\end{exampleblock}

\scriptsize @palmer2018systematic \par \normalsize

## Unbequeme Wahrheiten ... (III)

**Der Umgang mit fehlenden Werten in der (medizinisch-psychologischen) Forschung ist oftmals mangelhaft:** \scriptsize [@wood2004missing; @akl2015reporting; @vanbuuren, Kapitel 1.1.2; @bell2014handling] \par \normalsize

- Verteilung fehlender Werte nicht transparent berichtet
- Unpassendes missing data handling (z.B. **\alert{listwise deletion}**)
- Adäquate Imputationsmethoden (z.B. MI, FIML) häufig nicht benutzt, inadäquat angewendet, oder
unzureichend berichtet


## Unbequeme Wahrheiten ... (IV)

**\textsf{R} macht es nicht (automatisch) "richtig"!**

\small

```{r, eval=FALSE, comment="##>", background="green"}
y <- 1:10
x <- c(1, NA, NA, NA, 3, 5, 8, 10, -1, 10)
summary(lm(y ~ x))
```

```
## Coefficients:
##             Estimate Std. Error t value Pr(>|t|)  
## (Intercept)   4.9403     1.7738   2.785   0.0387 *
## x             0.3172     0.2709   1.171   0.2945  
## ---
## Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1
## 
## Residual standard error: 2.904 on 5 degrees of freedom
##   (3 observations deleted due to missingness)
```
\par \normalsize

## Unbequeme Wahrheiten ... (V)

**Was dagegen tun?**

- Umsetzung von **\alert{Reporting-Standards}** \scriptsize z.B. `STROBE` [@von2007strengthening] & `CONSORT` [@schulz2010consort], s.a. @sterne2009multiple. \par \normalsize
- Adäquates **\alert{Missing Data Handling}**
  - Basierend auf plausiblen Annahmen, warum fehlende Werte enstanden sind ("Missing Data Mechanism")
  - ggf. Schätzung (Imputation) fehlender Werte unter Einbezug von deren Unsicherheit

# MCAR, MAR & MNAR

## MCAR, MAR & MNAR (I)

\begin{multicols}{2}

  \null \vfill
  \includegraphics[width=.3\textwidth]{rubin.jpg}
  \newline Donald B. Rubin
  \vfill \null

\columnbreak

  \null \vfill
  \textbf{Grundannahme}: Das Fehlen oder Vorhandensein von Daten ist Resultat eines probabilistischen Prozesses. \newline \newline
  Diesem Prozess versucht man sich durch ein Modell (\textbf{\emph{missing data model}}) anzunähern. 
  \vfill \null
\end{multicols}

\small [@rubin1976inference] \par \normalsize

## MCAR, MAR & MNAR (II)

\includegraphics[width=1\textwidth]{model_concept_sep.png}

[@harrer2021doing]


## MCAR, MAR & MNAR (III)

\small

Nach @rubin1976inference können Missing Data-Mechanismen in 3 Untertypen klassifiziert werden: 

\metroset{block=fill} 

\begin{exampleblock}{MCAR}
  Missing Completely At Random: rein zufällig fehlende Werte einer Variable.
\end{exampleblock}

\begin{exampleblock}{MAR}
  Missing At Random: das Fehlen von Werten einer Variable ist abhängig von anderen (observierten) Variablen.
\end{exampleblock}

\begin{exampleblock}{MNAR}
  Missing Not At Random / "Nonignorable Missing Data": das Fehlen von Werten Variable ist (u.A.) abhängig von den Werten der Variable selbst.
\end{exampleblock}

&rightarrow; Für jede Annahme ergeben sich unterschiedliche Auswirkungen bei der Datenauswertung!

\par \normalsize

## MCAR, MAR & MNAR (IV)

**Notation** \scriptsize [@vanbuuren, Kapitel 2.2.3 & 2.2.4] \par \normalsize

- $\mathbf{Y}$: $n\times p$ Matrix mit teils fehlenden Werten ($n$ Personen, $p$ Variablen).
- $\mathbf{X}$: Matrix mit (vollständig observierten) Kovariaten.
- $\mathcal{D} = (\mathbf{Y}, \mathbf{X})$: Gesamter Datensatz.
- $\mathbf{R}$: $n\times p$ Matrix mit 0 (Datenpunkt fehlt) und 1 (Datenpunkt observiert; "response indicator").
- $\mathbf{Y}_{\text{obs}}$, $\mathbf{Y}_{\text{mis}}$: Observierte Daten, fehlende Daten.
- $\psi$: Parameter des Missing Data-Modells (typischerweise nicht für die wiss. Fragestellung selbst relevant).

&rightarrow; Missing Data-Modelle treffen Aussagen darüber, **\alert{in welcher Beziehung}** $\mathbf{Y}_{\text{obs}}$, $\mathbf{Y}_{\text{mis}}$ und $\mathbf{R}$ miteinander stehen. 


## MCAR, MAR & MNAR (V)

**MCAR**

$$P(\mathbf{R}=0|\mathbf{Y}_{\text{obs}}, \mathbf{Y}_{\text{mis}}, \psi) \Rightarrow P(\mathbf{R}=0|\psi)$$
Werte in $\mathbf{Y}$ fehlen "zufällig" (unabhängig von Werten von $\mathbf{Y}$). Das Fehlen von Werten ist nur bestimmt durch die allgemeine Wahrscheinlichkeit, dass Werte fehlen (im Datensatz gab es eher viele oder wenige Missings). \linebreak


\metroset{block=fill} 

\begin{exampleblock}{Beispiel}
  Das Fehlen der Variable "Alter" ist weder von der Variable "Neurotizismus", noch vom Alter der Person selbst abhängig.
\end{exampleblock}


## MCAR, MAR & MNAR (VI)

**MAR**

$$P(\mathbf{R}=0|\mathbf{Y}_{\text{obs}}, \mathbf{Y}_{\text{mis}}, \psi) \Rightarrow P(\mathbf{R}=0|\mathbf{Y}_{\text{obs}}, \psi)$$

Werte in $\mathbf{Y}$ fehlen abhängig von $\psi$ **und** **\alert{observierter}** Information $\mathbf{Y}_{\text{obs}}$. \linebreak


\metroset{block=fill} 

\begin{exampleblock}{Beispiel}
  Personen mit höheren Neurotizismus-Werten geben ihr Alter seltener an als Personen mit niedrigem Neurotizismus, unabhängig ihres Alters.
\end{exampleblock}


## MCAR, MAR & MNAR (VII)

**MNAR**

$$P(\mathbf{R}=0|\mathbf{Y}_{\text{obs}}, \mathbf{Y}_{\text{mis}}, \psi) \Rightarrow~?$$
_Die Formel lässt sich nicht "vereinfachen" !_

Werte in $\mathbf{Y}$ fehlen abhängig von $\psi$, observierter Information $\mathbf{Y}_{\text{obs}}$, **und** der **\alert{unobservierten Information}** $\mathbf{Y}_{\text{mis}}$ selbst. \linebreak


\metroset{block=fill} 

\begin{exampleblock}{Beispiel}
  Das Fehlen der Alters-Variable hängt (u.A.) vom Alter der Person selbst ab. Eventuell geben ältere Personen mit hohem Neurotizismus ihr Alter seltener an. \textbf{Aber das wissen wir nicht}, da die Daten fehlen!
\end{exampleblock}


## MCAR, MAR & MNAR (VIII)


**Observierte und unobservierte Werte unter drei Missing Data-Annahmen**

\includegraphics[width=0.8\textwidth]{buuren-mechanisms.png}

aus @vanbuuren, Kapitel 2.2.4


## MCAR, MAR & MNAR (IX)

**Implikationen**

- **MCAR**: Da die Werte zufällig fehlen, ist beim Einsatz passender statistischer Verfahren keine Verzerrung der Ergbnisse zu erwarten. Es besteht kein systematischer **\alert{Bias}**; nur ein Verlust der statistischen Power durch den Datenverlust.
- **MAR**: Bei der Schätzung von Parametern ergeben sich evtl. Verzerrungen (Bias), wenn die abhängigen Variablen nicht im Modell berücksichtigt werden. Werden die abhängigen Variablen adäquat mit einbezogen, können Verzerrungen vermieden werden.


## MCAR, MAR & MNAR (X)


- **MNAR**: Bei der Schätzung von Parametern ergeben sich Verzerrungen. Da das Fehlen von Werten von den fehlenden Werten selbst abhängig ist, können nur "best guesses" hinsichtlich des **\alert{zugrundeliegenden Dropout-Mechanismus}** getroffen werden. Ob diese korrekt sind, kann nicht empirisch überprüft werden. 

## MCAR, MAR & MNAR (XI)

Beim Vorliegen von MNAR spricht man von **\alert{"nonignorable missing data"}** [@little2019statistical]. Dies bedeutet, dass \underline{nicht} von der gemeinsamen (Posterior-)**Verteilung der observierten Daten auf die der fehlenden Daten geschlossen werden kann**:

$$P(\mathbf{Y}|\mathbf{Y}_{\text{obs}}, \mathbf{R}=1) \neq P(\mathbf{Y}|\mathbf{Y}_{\text{obs}},\mathbf{R}=0)$$

Das impliziert, dass eine Schätzung (Imputation) auf Basis der vorliegenden Werte nicht ohne weiteres möglich ist. Es müssen Annahmen getroffen werden, die **\alert{"über die Daten hinaus gehen"}**. 

## MCAR, MAR & MNAR (XII)

**Was bedeutet das für die Analyse von RCT-Daten?**

\begin{center}
\alert{\textbf{MCAR}}
\end{center}

- Complete Case-Analysen und andere Ad Hoc-Verfahren führen nicht zu einer systematischen Verzerrung der Ergebnisse (aber durchaus zu einem Verlust statistischer Power/"Effizienz"). 

- Die MCAR-Annahme ist typischerweise für RCT-Daten **\alert{nicht sehr plausibel}**. \scriptsize [@bell2014handling; @mallinckrodt2004choice] \par \normalsize

- Selbst wenn die MCAR-Annahme zutrifft, können Verfahren wie Multiple Imputation genutzt werden, z.B. um Konfidenzintervalle korrekter zu schätzen. \scriptsize [vgl. @pedersen2017missing] \par \normalsize


## MCAR, MAR & MNAR (XIII) {.t}

**Was bedeutet das für die Analyse von RCT-Daten?**

\begin{center}
\alert{\textbf{MAR}}
\end{center}

- Complete Case-Analysen führen zu einer Verzerrung der Ergebnisse. 
- Verfahren wie Multiple Imputation, Full Information Maximum Likelihood (FIML) oder Mixed-Effect Models (eingeschränkt) können aber **\alert{genutzt werden, um die MAR-Annahme abzubilden}**. 
- Werden diese Modelle korrekt angewandt, vermeidet dies gebiaste Ergebnisse und führt zu einem korrekten Miteinbezug der Unsicherheit durch fehlende Werte (&rightarrow; passende Konfidenzintervalle).

## MCAR, MAR & MNAR (XIV) {.t}


**Was bedeutet das für die Analyse von RCT-Daten?**

\begin{center}
\alert{\textbf{MNAR}}
\end{center}

- Auch Verfahren wie Multiple Imputation (denen nur die observierten Daten zugrunde liegen) können zu **\alert{Verzerrungen in den Ergebnissen führen}**. 
- Methoden wie Pattern-Mixture oder Selektionmodelle können genutzt werden, um die Ergebnisse unter Annahme bestimmter Dropout-Mechanismen zu analysieren. \scriptsize [@little2019statistical, Kapitel 15; @heckman1976common] \par \normalsize 
- Diese Annahmen sind jedoch nicht direkt empirisch nachweisbar.


## MCAR, MAR & MNAR (XV) 


_"MNAR models are [...] typically **\alert{highly dependent on untestable and often implicit assumptions}** regarding the
distribution of the unobserved measurements given the observed measurements."_


\textemdash @molenberghs2004analyzing, S. 447




## MCAR, MAR & MNAR (XVI) 

\alert{\textbf{Was soll ich für meinen Trial annehmen?}}


_"[W]e recommend that in trials [...], all data should be used in an analysis that makes a plausible assumption about missing data. Usually this will be a MAR assumption."_

\footnotesize
\textemdash @bell2014handling \par \normalsize

_"The assumption of ignorability is often sensible in practice, and generally provides a natural starting point."_

\footnotesize
\textemdash @vanbuuren, Kapitel 2.2.6 \par \normalsize

## Zusammenfassung

- Dropout & Fehlende Daten sind bei RCTs **kaum zu vermeiden**.

- Das Fehlen von Daten kann man sich als **"Produkt" eines wahrscheinlichkeitsbasierten Prozesses** vorstellen, der von einem (realen oder angenommenen) **Missing Data-Mechanismus** gesteuert wird.

- Derartige Mechanismen lassen sich in drei "Archetypen" zusammenfassen: **MCAR**, **MAR** und **MNAR**.

- Wird der zugrundeliegende Missing Data-Mechanismus \underline{nicht} berücksichtigt, kann dies bei der Analyse zu **Verzerrungen** und **falschen Schlußfolgerungen** führen.

\begin{tikzpicture}[remember picture,overlay]  
  \node [xshift=-0.7cm,yshift=-8.7cm] at (current page.north east)
    {\includegraphics[width=1cm,height=1cm]{summary.png}};
\end{tikzpicture}

## Zusammenfassung


- Ob Daten MAR oder MNAR sind, kann **\underline{nicht} anhand der Daten selbst bestimmt werden**; beide Annahmen sind immer nur mehr oder weniger plausibel.

- Bei RCTs ist die **Annahme von MAR häufig ein guter Startpunkt**; die Ergebnisse im Fall von nonignorable missing data (MNAR) können dann z.B. durch Sensitivitätsanalysen geprüft werden [@bell2014handling].

- Insbesondere **multiple Imputationsverfahren** sind ein gutes Mittel, Verzerrungen der Ergebnisse durch Dropout unter Annahme von MAR vorzubeugen.


\begin{tikzpicture}[remember picture,overlay]  
  \node [xshift=-0.7cm,yshift=-8.7cm] at (current page.north east)
    {\includegraphics[width=1cm,height=1cm]{summary.png}};
\end{tikzpicture}

## Zusammenfassung

\small

\metroset{block=fill} 

\begin{exampleblock}{Kurze Anmerkung zu Little's MCAR Test}
  Der $\chi^2$ MCAR Test von Little () findet immer noch häufig bei der Analyse von RCT Verwendung.
  Die Nullhypothese ist hierbei, dass Missings in den Daten zufällig auftreten (MCAR). 
  Der praktische Nutzen dieses Tests ist häufig begrenzt: die Fähigkeit des Tests, die Nullhypothese (MCAR) hängt von der Größe des Datensets, und damit der statistischen Power ab. Bei großen Datensets können schon kleine Abweichungen zu einem Wert $p$<0.05 führen. 
\end{exampleblock}

\par \normalsize

# Second Section

## Second Frame

### Bulleted Lists
- Element A
- Element B
    - B.1
    - B.2
- Element C    

# Elements

## Typography

```
The theme provides sensible defaults to
\emph{emphasize} text, \alert{accent} parts
or show \textbf{bold} results.

In Markdown, you can also use _emphasize_ and **bold**.
```

\begin{center}becomes\end{center}

The theme provides sensible defaults to \emph{emphasize} text,
\alert{accent} parts or show \textbf{bold} results \scriptsize [@arendt1989leben; @smit2006costs; @andersson2009internet] \par.

In Markdown, you can also use _emphasize_ and **bold**.


## Math

\begin{equation*}
    e = \lim_{n\to \infty} \left(1 + \frac{1}{n}\right)^n
\end{equation*}


## R Figure Example

The following code generates the plot on the next slide (taken from
`help(bxp)` and modified slightly):

```{r pressureCode, eval=FALSE}
library(stats)
set.seed(753)
bx.p <- boxplot(split(rt(100, 4),
                      gl(5, 20)), plot=FALSE)
bxp(bx.p, notch = FALSE, boxfill = "lightblue",
    frame = FALSE, outl = TRUE,
    main = "Example from help(bxp)")
```  


## R Figure Example
  
```{r pressureFig, echo=FALSE}
library(stats)
set.seed(753)
bx.p <- boxplot(split(rt(100, 4),
                      gl(5, 20)), plot=FALSE)
bxp(bx.p, notch = FALSE, boxfill = "lightblue",
    frame = FALSE, outl = TRUE,
    main = "Example from help(bxp)")
```  

## R Table Example
  
A simple `knitr::kable` example:  

```{r kableEx}
knitr::kable(mtcars[1:5, 1:8],
             caption="(Parts of) the mtcars dataset")
```

## Using LaTeX Parts: Blocks

As one example of falling back into \LaTeX, consider the example of
three different block environments are pre-defined and may be styled
with an optional background color.

\metroset{block=fill} 

\begin{block}{Default}
  Block content.
\end{block}

\begin{alertblock}{Alert}
  Block content.
\end{alertblock}

\begin{exampleblock}{Example}
  Block content.
\end{exampleblock}



## Resources

### For more information:
- See the [Metropolis repository](https://github.com/matze/mtheme) for more on Metropolis
- See the [RMarkdown repository](https://github.com/rstudio/rmarkdown) for more on RMarkdown
- See the [binb repository](https://github.com/eddelbuettel/binb) for more on binb 
- See the [binb vignettes](https://github.com/eddelbuettel/binb/vignettes) for more examples.

## References {.allowframebreaks}

\scriptsize





